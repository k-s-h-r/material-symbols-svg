const { WEIGHTS, toPascalCase, generatePathDataString } = require('./common');

const CREATE_ICON_PATH = '../createMaterialIcon';

/**
 * Generate Vue icon file content
 */
function generateIconFileContent(iconName, style, paths, isIdentical) {
  const componentName = toPascalCase(iconName);
  const filledComponentName = `${componentName}Fill`;

  const { pathDataString, metadataString } = generatePathDataString(componentName, style, paths, isIdentical);

  const regularExports = WEIGHTS.map(w => 
    `/**
 * ${componentName} (Weight: ${w}) - ${style.charAt(0).toUpperCase() + style.slice(1)} style
 * @preview ![img](data:image/svg+xml;base64,${paths.previews.regular[w]})
 */
export const ${componentName}W${w} = /*#__PURE__*/ createMaterialIcon('${iconName}', pathData.regular[${w}]);`
  ).join('\n\n');

  const filledExports = WEIGHTS.map(w => {
    const dataKey = isIdentical ? 'regular' : 'filled';
    const previewKey = isIdentical ? 'regular' : 'filled';
    return `/**
 * ${filledComponentName} (Weight: ${w}) - ${style.charAt(0).toUpperCase() + style.slice(1)} style (Filled)
 * @preview ![img](data:image/svg+xml;base64,${paths.previews[previewKey][w]})
 */
export const ${filledComponentName}W${w} = /*#__PURE__*/ createMaterialIcon('${iconName}', pathData.${dataKey}[${w}]);`;
  }).join('\n\n');

  return `/* eslint-disable */
// This file is auto-generated by build scripts.
// Do not edit this file directly.
import { createMaterialIcon, type MaterialSymbolsComponent } from '${CREATE_ICON_PATH}';

${pathDataString}${metadataString}// --- Regular ---
${regularExports}

// --- Filled ---
${filledExports}

// Export metadata for tooling
export const ${componentName}Metadata = metadata;
`;
}

/**
 * Generate Vue export file content for a specific weight
 */
function generateExportFileContent(iconFiles, weight) {
  let exportsContent = `/* eslint-disable */
// This file is auto-generated by build scripts.
// Do not edit this file directly.

export type { IconProps, MaterialSymbolsComponent } from './types';

`;

  for (const iconFile of iconFiles) {
    const iconName = iconFile.replace('.ts', '');
    const componentName = toPascalCase(iconName);
    const filledComponentName = `${componentName}Fill`;
    
    const internalName = `${componentName}W${weight}`;
    const internalFilledName = `${filledComponentName}W${weight}`;

    exportsContent += `export { ${internalName} as ${componentName}, ${internalFilledName} as ${filledComponentName} } from './icons/${iconName}';\n`;
  }

  return exportsContent;
}

/**
 * Get package directory mapping for Vue
 */
function getPackageMapping() {
  return {
    'outlined': 'vue',
    'rounded': 'vue-rounded', 
    'sharp': 'vue-sharp'
  };
}

module.exports = {
  generateIconFileContent,
  generateExportFileContent,
  getPackageMapping
};
